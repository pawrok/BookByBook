#:kivy 2.0

<RootRoot>:
    orientation: 'vertical'
    BoxLayout:
        id: top_panel
        canvas:
            Color:
                rgb: 0.85, .6, .6
            Rectangle:
                pos: self.pos
                size: self.size
        size_hint_y: 0.07
        Label:
            text: "Bookcase App"

    RootScreenManager:
        id: rootmanager

    BoxLayout:
        id: bottommenu
        orientation: 'horizontal'
        size_hint_y: None
        height: '48dp'
        padding: '5dp'
        canvas:
            Color:
                rgb: .3, .3, .3
            Rectangle:
                pos: self.pos
                size: self.size

        Button:
            text: 'Home'
            width: self.height
            on_release:
                # rootmanager.clear_widgets()
                app.add_home_screen()
                rootmanager.current = 'home'

        Button:
            text: 'Stats'
            width: self.height
            on_release: rootmanager.current = 'stats'

        Button:
            text: '+'
            width: self.height
            on_release: rootmanager.current = 'new'

        Button:
            text: 'Wishlist'
            width: self.height
            on_release: rootmanager.current = 'wish'

        Button:
            text: 'Settings'
            width: self.height
            on_release: rootmanager.current = 'settings'


<RootScreenManager>:
    id: rootmanager
    home_screen: home_screen.__self__
    size: root.width, root.height
    HomeScreen:
        id: home_screen
    StatsScreen:
    AddScreen:
    WishScreen:
    SettingsScreen:

<HomeScreen>:
    name: "home"
    id: home_screen
    BoxLayout:
        canvas:
            Color:
                rgb: 0.3, 0.3, 0.3
            Rectangle:
                pos: self.pos
                size: self.size
        orientation: 'vertical'

        BoxLayout:
            size_hint_y: 0.1
            orientation: 'horizontal'
            Button:
                text: 'books'
                on_press: middlemanager.current = 'book'
            Button:
                text: 'shelves'
                on_press: middlemanager.current = 'shelf'
            Button:
                text: 'tags'
                on_press: middlemanager.current = 'tag'

        BoxLayout:
            size_hint_y: 0.08
            TextInput:
                multiline: False
                size_hint_x: 0.8
            Button:
                text: "Sort"
                size_hint_x: None

        MiddleScreenManager:
            id: middlemanager

<AddScreen>:
    # TODO
    name: 'new'
    BoxLayout:
        # padding: '10dp', '0dp'
        canvas:
            Color:
                rgb: 0.3, 0.3, 0.3
            Rectangle:
                pos: self.pos
                size: self.size
        BoxLayout:
            orientation: 'vertical'
            BoxLayout:
                padding: '5dp', '5dp'
                id: topaddbook
                orientation: 'horizontal'
                size_hint_y: 0.37
                Button:
                    background_normal: ''
                    background_color: 1, .9, .9, .99
                    text: 'add image'
                    size_hint_x: 0.33
                BoxLayout:
                    padding: '5dp', '5dp'
                    size_hint_x: 0.34
                    orientation: 'vertical'
                    StarsButton:
                        id: stars_rating
                        # size_hint_x: 0.47

                    BoxLayout:
                        padding: '5dp', '5dp'
                        orientation: 'horizontal'

                        Button:
                            background_normal: ''
                            background_color: 1, .9, .9, .99
                            text: 'read'
                            size_hint: .6, .6

                        Button:
                            background_normal: ''
                            background_color: 1, .9, .9, .99
                            id: fav_btn
                            size_hint: .6, .6
                            # pos_hint: {"x":0.35, "y":0.3}
                            # color: 1, 1, 1, 1
                            Image:
                                allow_stretch: True
                                size: fav_btn.size
                                source: 'images/heart_black.png'
                                pos: fav_btn.pos
                BoxLayout:
                    padding: '10dp', '10dp'
                    size_hint_x: 0.33

                    Button:
                        # size_hint_y: .6
                        background_normal: ''
                        background_color: 1, .5, .6, .85
                        text: 'Save book'
                        on_press:
                            if root.book_id > 0: \
                            app.update_book_in_db(
                            root.book_id, input_title.text, input_author.text,
                            input_category.text, stars_rating.rating, input_rented_person.text,
                            input_date_completed.text, input_pages.text); \
                            print(root.book_id); \
                            root.reset_properties()
                            else: \
                            app.add_book_to_db(
                            input_title.text, input_author.text, input_category.text,
                            stars_rating.rating, input_rented_person.text,
                            input_date_completed.text, input_pages.text); \
                            root.reset_properties()


            BoxLayout:
                orientation: 'vertical'
                id: titleauthorstuff
                TextInput:
                    id: input_title
                    # border: 0, 0, 0, 0
                    # background_color: 1, 1, 1, 1
                    text: root.input_title
                    size_hint_y: 0.15
                TextInput:
                    id: input_author
                    text: root.input_author
                    size_hint_y: 0.15
                TextInput:
                    id: input_category
                    text: root.input_category
                    size_hint_y: 0.15
                TextInput:
                    id: input_rented_person
                    text: root.input_rented_person
                    size_hint_y: 0.15
                TextInput:
                    id: input_date_completed
                    text: root.input_date_completed
                    size_hint_y: 0.15
                TextInput:
                    id: input_pages
                    size_hint_y: 0.15
                    text: str(root.input_pages)

                TextInput:
                # todo
                    size_hint_y: None
                    text: "description"

<StatsScreen>:
    name: "stats"
    BoxLayout:
        orientation: 'vertical'
        canvas:
            Color:
                rgb: 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size

<WishScreen>:
    name: "wish"
    BoxLayout:
        canvas:
            Color:
                rgb: 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size

<SettingsScreen>:
    name: "settings"
    BoxLayout:
        canvas:
            Color:
                rgb: 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size
        Button:
            text: "DELETE ALL BOOKS"
            on_press: root.delete_DB()

<StarsButton>:
    orientation: 'horizontal'
    padding: '5dp', '5dp'

    Button:
        id: first_s
        size_hint_y: 0.7
        text: '*'
        background_normal: ''
        background_color: 0.3, 0.3, 0.3, 1
        color: 0, 0, 0, 1
        on_press:
            root.set_rating(1)

    Button:
        id: sec_s
        size_hint_y: 0.7
        text: '*'
        background_normal: ''
        background_color: 0.3, 0.3, 0.3, 1
        color: 0, 0, 0, 1
        on_press:
            root.set_rating(2)

    Button:
        id: third_s
        size_hint_y: 0.7
        text: '*'
        background_normal: ''
        background_color: 0.3, 0.3, 0.3, 1
        color: 0, 0, 0, 1
        on_press:
            root.set_rating(3)

    Button:
        id: fourth_s
        size_hint_y: 0.7
        text: '*'
        background_normal: ''
        background_color: 0.3, 0.3, 0.3, 1
        color: 0, 0, 0, 1
        on_press:
            root.set_rating(4)

# --------------------------------------------------------------- #
# home screens

<MiddleScreenManager>:
    id: middlemanager
    Books:
    Shelves:
    Tags:

<Books>:
    name: 'book'

    BoxLayout:
        padding: 10
        canvas:
            Color:
                rgb: 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size

        BookScrollView:
            # size_hint: (1, None)
            # size_hint_y: None
            # height: root.height
            do_scroll_x: False
            do_scroll_y: True

<Shelves>:
    name: 'shelf'
    canvas:
        Color:
            rgb: 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
    ShelfViewer:
        # data: app.data
        # spacing: 800
        # padding: 300, 300
        viewclass: 'ShelfItem'
        # space_x: self.size[0]/3
        # orientation: "vertical"
        RecycleBoxLayout:
            orientation: "vertical"
            default_size: dp(100), dp(50)
            # col_default_width: self.width / 4
            # default_size_hint: None, None
            # size_hint_y: None
            # spacing: dp(2)
            default_size_hint: 1, None
            size_hint_y: None
            height: self.minimum_height

<Tags>:
    name: 'tag'
    canvas:
        Color:
            rgb: 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size

    Label:
        text: "tag screen"


# --------------------------------------------- #
# widgets for MiddleScreenManager

<BookItem>:
    # height: root.height
    # width: self.width
    height: self.width * 1.4
    orientation: 'vertical'
    size_hint_y: None
    # size_hint_x: None

    Button:
        background_normal: ''
        background_color: 1, .9, .9, .99
        text: 'image here'
        size_hint_y: 0.8
        on_release: app.open_edit_book(root.book_id)

    Label:
        size_hint_y: 0.2
        color: 0.5, .2, .3, 0.6
        text: root.title

<ShelfItem>:

    BoxLayout:
        orientation: 'vertical'
        padding: '5dp'

        Button:
            size_hint_y: 0.2
            text: root.shelf_title
